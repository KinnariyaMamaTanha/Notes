>关于函数栈帧，可参考[[函数栈帧_c++ 栈帧结构]]，以及[第7篇：C/C++程序栈-帧 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/184971164)

![[C++ 栈帧.png|500]]

## 1. 自动存储

>*在函数内部定义的常规变量使用自动存储空间，称为自动变量*

1. 自动变量是局部变量，在执行完所属函数或代码块后被释放
2. 自动变量通常储存在栈中
3. 声明一个自动变量，会隐藏同名的外部变量
4. 自动变量可设置为寄存器变量(但全局变量和静态局部变量**不能**设置为寄存器变量)，直接存储在CPU的寄存器中，提高变量访问速度（当没有合适的寄存器可用时，设置为自动变量），使用关键字`register`（现在的编译器会自动将频繁使用的自动变量优化为寄存器变量）
5. 自动变量在函数/代码块调用时被初始化，且当没有指定初始值时，被初始化为一个不确定的值（对比静态变量）

## 2. 静态存储

### 2.1 静态变量

1. 声明静态变量方式
	1. 在函数外定义变量
	2. 使用`static`定义
2. 在程序整个运行过程中都存在
3. 有三种链接性[^链接性]：外部链接性、内部链接性、无链接性，声明方式：
```c++
typeName x; // 外部链接性, 可在程序的其他文件中使用(需要配合使用extern)
static typeName x; // 内部链接性, 只能在当前文件中使用
void func()
{
	static typeName x; // 无链接性, 只能在函数中调用
}
```
4. 静态变量的初始化（在**编译**时就进行了初始化，而不是运行时）
	1. 静态初始化 
		1. 零初始化：默认将静态变量**初始化为0**
		2. 常量初始化
	2. 动态初始化

### 2.2 外部变量(全局变量)

#### 2.2.1 常规外部变量 

1. 定义：**链接性为外部**的变量，储存持续性为静态，作用域为整个文件，也叫全局变量
2. **单定义规则**：变量只能有一次定义
3. **两种变量声明**：定义声明、引用声明
```c++
// file1.cpp
typeName x; // 定义声明
// file2.cpp
extern typeName x; // 引用声明
```
4. 引用声明不能进行初始化，否则将会被视为定义
5. `extern`还可以用于函数内，表示使用全局中的变量，可以先使用`extern`，再定义全局变量（当全局变量在`extern`声明之前时，也可以省略），如：
```c++
void func()
{
	extern int x;
	std::cout << x;
}
// Global scope
int x = 20
```

6. 当外部变量被自动变量隐藏的时候，可以使用作用域解析运算符`::`来调用外部变量
```c++
#include <iostream>
int x = 10;
void func(int x)
{
	x = 1;
	std::cout << x << std::endl;
	std::cout << ::x << std::endl;
}
```

#### 2.2.2 静态外部变量

1. 当声明了一个静态外部变量后，将会**隐藏同名的常规外部变量**
2. 静态外部变量用于在**单个文件**的不同函数间传递数据，并且避免被其他文件调用
3. 静态函数类似，也只能在单个文件中使用

### 2.3 无链接性的静态变量(静态局部变量)

1. 作用域在整个程序，但是只能在特定代码块中被使用
2. 只会被初始化一次，第二次运行到初始化语句时，将不再进行初始化
3. 在两次调用之间，值不会改变

## 动态存储

>*`new`和`delete`管理了一个内存池，被称为自由存储空间或堆*

1. 动态数据生命周期不完全受程序或函数的生存时间控制，用`new`运算符分配的内存将一直存在，直到使用`delete`运算符将其释放或程序结束为止

## 线程存储

1. 使用`thread_local`声明的变量

## 内存分布

>参考[C++ 内存分区_c++内存分区-CSDN博客](https://blog.csdn.net/u011718663/article/details/118186352?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170333080516800226537374%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=170333080516800226537374&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-2-118186352-null-null.142^v96^pc_search_result_base7&utm_term=C%2B%2B%20%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA&spm=1018.2226.3001.4187)，[C++ 学习（九）内存分区（代码区、全局区、栈区、堆区）_c++运行时 堆,栈,代码,全局区存储地址-CSDN博客](https://blog.csdn.net/ling1998/article/details/125935731)

| 区名       | 存储内容 |
| ---------- | -------- |
| 代码区     |          |
| 全局数据区 |  全局变量，静态局部变量，类的静态数据成员        |
| 堆区       |由new分配的动态内存(动态变量)          |
| 栈区           |  主要为自动变量(当函数被调用时，分配空间；调用结束时，释放空间)        |

![[C++变量的作用域和存储类型.png]]


[^链接性]:链接性与作用域不同，在作用域中有可能不能被链接（如静态变量的第三种，作用域是整个程序执行期间，但只能在代码块中被使用）